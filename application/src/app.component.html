<!--
  File: src/app.component.html
  Project: fireCNC
  Author: Mark Dyer
  Location: Blenheim, New Zealand
  Contact: intelliservenz@gmail.com

  Description:
  Main template for the application. It includes the header, navigation,
  router outlet, and footer.
-->
<div class="h-screen bg-gray-900 text-gray-200 flex flex-col" [class.select-none]="!arduinoService.watchdogConfig().TEXT_SELECTION_ENABLED">

  <header class="sticky top-0 z-40 bg-gray-900/95 backdrop-blur-sm border-b border-gray-700">
    <div class="px-4 sm:px-6 lg:px-8 py-1 sm:py-2 lg:py-3">
      <div class="flex justify-between items-center">
        <div class="flex items-center gap-4">
          <!-- Mobile Menu Toggle Button -->
          <button (click)="toggleMobileMenu()" class="md:hidden p-2 text-gray-300 hover:text-orange-400 focus:outline-none">
            <i class="fa-solid fa-bars text-xl"></i>
          </button>
          <a routerLink="/dashboard" class="flex items-center mr-4 translate-x-2">
            <h1 class="text-2xl sm:text-3xl font-bold text-orange-400 tracking-wider flex items-center">
              <span class="ml-[-0.75rem] mr-1 text-orange-500 text-2xl">ðŸ”¥</span>
              fireCNC
            </h1>
          </a>
          <nav class="hidden md:flex items-center space-x-4">
            <a routerLink="/dashboard"
               routerLinkActive="text-orange-400 border-orange-400"
               [routerLinkActiveOptions]="{exact: true}"
               [title]="'nav.dashboard' | translate"
               class="text-gray-300 hover:text-orange-400 border-b-2 border-transparent hover:border-orange-400 transition-colors duration-200 px-1 py-2 text-sm font-medium flex items-center">
              <i class="fa-solid fa-chart-line w-5 text-center"></i><span class="hidden lg:inline ml-2">{{ 'nav.dashboard' | translate }}</span>
            </a>
            <a routerLink="/status"
               routerLinkActive="text-orange-400 border-orange-400"
               [title]="'nav.status' | translate"
               class="text-gray-300 hover:text-orange-400 border-b-2 border-transparent hover:border-orange-400 transition-colors duration-200 px-1 py-2 text-sm font-medium flex items-center">
              <i class="fa-solid fa-network-wired w-5 text-center"></i><span class="hidden lg:inline ml-2">{{ 'nav.status' | translate }}</span>
            </a>
            <a routerLink="/leds"
               routerLinkActive="text-orange-400 border-orange-400"
               [title]="'nav.visuals' | translate"
               class="text-gray-300 hover:text-orange-400 border-b-2 border-transparent hover:border-orange-400 transition-colors duration-200 px-1 py-2 text-sm font-medium flex items-center">
              <i class="fa-solid fa-lightbulb w-5 text-center"></i><span class="hidden lg:inline ml-2">{{ 'nav.visuals' | translate }}</span>
            </a>
            @if (showPendantLink()) {
              <a [routerLink]="pendantLink()"
                routerLinkActive="text-orange-400 border-orange-400"
                [title]="'nav.pendant' | translate"
                class="text-gray-300 hover:text-orange-400 border-b-2 border-transparent hover:border-orange-400 transition-colors duration-200 px-1 py-2 text-sm font-medium flex items-center">
                <i class="fa-solid fa-hand-pointer w-5 text-center"></i><span class="hidden lg:inline ml-2">{{ 'nav.pendant' | translate }}</span>
              </a>
            }
            @if (isAlexaEnabled()) {
              <a routerLink="/alexa"
                routerLinkActive="text-orange-400 border-orange-400"
                [title]="'nav.alexa' | translate"
                class="text-gray-300 hover:text-orange-400 border-b-2 border-transparent hover:border-orange-400 transition-colors duration-200 px-1 py-2 text-sm font-medium flex items-center">
                <i class="fa-brands fa-amazon w-5 text-center"></i><span class="hidden lg:inline ml-2">{{ 'nav.alexa' | translate }}</span>
              </a>
            }
            <!-- Settings Dropdown -->
            <div class="relative pb-1" routerLinkActive #rla="routerLinkActive" (mouseenter)="openDropdown('settings')" (mouseleave)="closeDropdown('settings')">
              <button
                  (click)="toggleDropdown('settings')"
                  class="hover:text-orange-400 border-b-2 hover:border-orange-400 transition-colors duration-200 px-1 py-2 text-sm font-medium flex items-center focus:outline-none"
                  [class.text-orange-400]="rla.isActive"
                  [class.text-gray-300]="!rla.isActive"
                  [class.border-orange-400]="rla.isActive"
                  [class.border-transparent]="!rla.isActive">
                <i class="fa-solid fa-sliders w-5 text-center"></i><span class="hidden lg:inline ml-2">{{ 'nav.settings' | translate }}</span>
                <i class="fa-solid fa-chevron-down text-xs ml-2"></i>
              </button>
              <div class="absolute left-0 top-full w-56 bg-gray-800 border border-gray-700 rounded-md shadow-lg py-1 z-20" [class.hidden]="!isSettingsDropdownOpen()">
                <a routerLink="/settings/general" (click)="closeAllDropdowns()"
                   routerLinkActive="text-orange-400 bg-gray-700"
                   [routerLinkActiveOptions]="{exact: true}"
                   class="block w-full text-left px-4 py-2 text-sm text-gray-300 hover:bg-gray-700 hover:text-orange-400 cursor-pointer flex items-center">
                  <i class="fa-solid fa-gear w-6 text-center"></i>
                  <span>{{ 'subnav.settings.general' | translate }}</span>
                </a>
                <a routerLink="/settings/network" (click)="closeAllDropdowns()"
                   routerLinkActive="text-orange-400 bg-gray-700"
                   class="block w-full text-left px-4 py-2 text-sm text-gray-300 hover:bg-gray-700 hover:text-orange-400 cursor-pointer flex items-center">
                  <i class="fa-solid fa-ethernet w-6 text-center"></i>
                  <span>{{ 'subnav.settings.network' | translate }}</span>
                </a>
                 <a routerLink="/settings/dashboard" (click)="closeAllDropdowns()"
                   routerLinkActive="text-orange-400 bg-gray-700"
                   class="block w-full text-left px-4 py-2 text-sm text-gray-300 hover:bg-gray-700 hover:text-orange-400 cursor-pointer flex items-center">
                  <i class="fa-solid fa-table-columns w-6 text-center"></i>
                  <span>{{ 'subnav.settings.dashboard' | translate }}</span>
                </a>
                <div class="my-1 border-t border-gray-700"></div>
                <a routerLink="/settings/onboard" (click)="closeAllDropdowns()"
                   routerLinkActive="text-orange-400 bg-gray-700"
                   class="block w-full text-left px-4 py-2 text-sm text-gray-300 hover:bg-gray-700 hover:text-orange-400 cursor-pointer flex items-center">
                  <i class="fa-solid fa-microchip w-6 text-center"></i>
                  <span>{{ 'subnav.settings.onboardIo' | translate }}</span>
                </a>
                <a routerLink="/settings/expansion" (click)="closeAllDropdowns()"
                   routerLinkActive="text-orange-400 bg-gray-700"
                   class="block w-full text-left px-4 py-2 text-sm text-gray-300 hover:bg-gray-700 hover:text-orange-400 cursor-pointer flex items-center">
                  <i class="fa-solid fa-puzzle-piece w-6 text-center"></i>
                  <span>{{ 'subnav.settings.expansion' | translate }}</span>
                </a>
                @if (isAdminMode()) {
                  <div class="my-1 border-t border-gray-700"></div>
                  <a routerLink="/system/advanced/backup" (click)="closeAllDropdowns()"
                     routerLinkActive="text-orange-400 bg-gray-700"
                     class="block w-full text-left px-4 py-2 text-sm text-gray-300 hover:bg-gray-700 hover:text-orange-400 cursor-pointer flex items-center">
                    <i class="fa-solid fa-folder-open w-6 text-center"></i>
                    <span>{{ 'subnav.settings.backup' | translate }}</span>
                  </a>

                  <a routerLink="/system/advanced" (click)="closeAllDropdowns()"
                     routerLinkActive="text-orange-400 bg-gray-700"
                     class="block w-full text-left px-4 py-2 text-sm text-gray-300 hover:bg-gray-700 hover:text-orange-400 cursor-pointer flex items-center">
                    <i class="fa-solid fa-file-code w-6 text-center"></i>
                    <span>{{ 'subnav.settings.advanced' | translate }}</span>
                  </a>
                }
              </div>
            </div>
            <!-- System Dropdown -->
            <div class="relative pb-1" (mouseenter)="openDropdown('system')" (mouseleave)="closeDropdown('system')">
              <button (click)="toggleDropdown('system')" class="text-gray-300 hover:text-orange-400 border-b-2 border-transparent hover:border-orange-400 transition-colors duration-200 px-1 py-2 text-sm font-medium flex items-center focus:outline-none">
                <i class="fa-solid fa-gears w-5 text-center"></i><span class="hidden lg:inline ml-2">{{ 'nav.system' | translate }}</span>
                <i class="fa-solid fa-chevron-down text-xs ml-2"></i>
              </button>
              <div class="absolute left-0 top-full w-48 bg-gray-800 border border-gray-700 rounded-md shadow-lg py-1 z-20" [class.hidden]="!isSystemDropdownOpen()">
                @if (isAdminMode()) {
                  <a routerLink="/system/shell" (click)="closeAllDropdowns()" class="block w-full text-left px-4 py-2 text-sm text-gray-300 hover:bg-gray-700 hover:text-orange-400 cursor-pointer flex items-center">
                    <i class="fa-solid fa-terminal w-6 text-center"></i>
                    <span>{{ 'subnav.system.shell' | translate }}</span>
                  </a>
                  <a routerLink="/system/modules" (click)="closeAllDropdowns()" class="block w-full text-left px-4 py-2 text-sm text-gray-300 hover:bg-gray-700 hover:text-orange-400 cursor-pointer flex items-center">
                    <i class="fa-solid fa-puzzle-piece w-6 text-center"></i>
                    <span>{{ 'subnav.system.modules' | translate }}</span>
                  </a>
                  <div class="my-1 border-t border-gray-700"></div>
                }
                <button type="button" (click)="rebootDevice(); closeAllDropdowns()" class="block w-full text-left px-4 py-2 text-sm text-gray-300 hover:bg-gray-700 hover:text-orange-400 cursor-pointer flex items-center">
                  <i class="fa-solid fa-power-off w-6 text-center"></i>
                  <span>{{ 'subnav.system.reboot' | translate }}</span>
                </button>
              </div>
            </div>
          </nav>
        </div>
        <div class="flex items-center space-x-4">
          <!-- Information Dropdown -->
          <div class="relative group hidden md:flex pb-1" routerLinkActive #rlaInfo="routerLinkActive" (mouseenter)="openDropdown('information')" (mouseleave)="closeDropdown('information')">
            <button
                (click)="toggleDropdown('information')"
                class="hover:text-orange-400 border-b-2 hover:border-orange-400 transition-colors duration-200 px-1 py-2 text-sm font-medium flex items-center focus:outline-none"
                [class.text-orange-400]="rlaInfo.isActive"
                [class.text-gray-300]="!rlaInfo.isActive"
                [class.border-orange-400]="rlaInfo.isActive"
                [class.border-transparent]="!rlaInfo.isActive">
              <i class="fa-solid fa-circle-info w-5 text-center"></i><span class="hidden lg:inline ml-2">{{ 'nav.information' | translate }}</span>
              <i class="fa-solid fa-chevron-down text-xs ml-2"></i>
            </button>
            <div class="absolute left-0 top-full w-64 bg-gray-800 border border-gray-700 rounded-md shadow-lg py-1 z-20" [class.hidden]="!isInformationDropdownOpen()">
              <a routerLink="/information/about" (click)="closeAllDropdowns()" class="block w-full text-left px-4 py-2 text-sm text-gray-300 hover:bg-gray-700 hover:text-orange-400 cursor-pointer flex items-center">
                <i class="fa-solid fa-circle-info w-6 text-center"></i>
                <span>{{ 'subnav.info.about' | translate }}</span>
              </a>
              <a routerLink="/information/hardware" (click)="closeAllDropdowns()" class="block w-full text-left px-4 py-2 text-sm text-gray-300 hover:bg-gray-700 hover:text-orange-400 cursor-pointer flex items-center">
                <i class="fa-solid fa-cubes w-6 text-center"></i>
                <span>{{ 'subnav.info.hardware' | translate }}</span>
              </a>
              <a routerLink="/information/software" (click)="closeAllDropdowns()" class="block w-full text-left px-4 py-2 text-sm text-gray-300 hover:bg-gray-700 hover:text-orange-400 cursor-pointer flex items-center">
                <i class="fa-solid fa-save w-6 text-center"></i>
                <span>{{ 'subnav.info.software' | translate }}</span>
              </a>
              <a routerLink="/information/logic" (click)="closeAllDropdowns()" class="block w-full text-left px-4 py-2 text-sm text-gray-300 hover:bg-gray-700 hover:text-orange-400 cursor-pointer flex items-center">
                <i class="fa-solid fa-atom w-6 text-center"></i>
                <span>{{ 'subnav.info.logic' | translate }}</span>
              </a>
              <a routerLink="/information/routes" (click)="closeAllDropdowns()" class="block w-full text-left px-4 py-2 text-sm text-gray-300 hover:bg-gray-700 hover:text-orange-400 cursor-pointer flex items-center">
                <i class="fa-solid fa-route w-6 text-center"></i>
                <span>{{ 'subnav.info.routes' | translate }}</span>
              </a>
              <div class="my-1 border-t border-gray-700"></div>
              <a routerLink="/information/changelog" (click)="closeAllDropdowns()" class="block w-full text-left px-4 py-2 text-sm text-gray-300 hover:bg-gray-700 hover:text-orange-400 cursor-pointer flex items-center">
                <i class="fa-solid fa-history w-6 text-center"></i>
                <span>{{ 'subnav.info.changelog' | translate }}</span>
              </a>
              <a routerLink="/information/help" (click)="closeAllDropdowns()" class="block w-full text-left px-4 py-2 text-sm text-gray-300 hover:bg-gray-700 hover:text-orange-400 cursor-pointer flex items-center">
                <i class="fa-solid fa-book-open w-6 text-center"></i>
                <span>{{ 'subnav.info.help' | translate }}</span>
              </a>
            </div>
          </div>
          <!-- Activity Dropdown -->
          <div class="relative group hidden md:flex pb-1" routerLinkActive #rlaActivity="routerLinkActive" (mouseenter)="openDropdown('activity')" (mouseleave)="closeDropdown('activity')">
            <button
                (click)="toggleDropdown('activity')"
                class="hover:text-orange-400 border-b-2 hover:border-orange-400 transition-colors duration-200 px-1 py-2 text-sm font-medium flex items-center focus:outline-none"
                [class.text-orange-400]="rlaActivity.isActive"
                [class.text-gray-300]="!rlaActivity.isActive"
                [class.border-orange-400]="rlaActivity.isActive"
                [class.border-transparent]="!rlaActivity.isActive">
                <i class="fa-solid fa-chart-area w-5 text-center"></i><span class="hidden lg:inline ml-2">{{ 'nav.activity' | translate }}</span>
                <i class="fa-solid fa-chevron-down text-xs ml-2"></i>
            </button>
            <div class="absolute left-0 top-full w-48 bg-gray-800 border border-gray-700 rounded-md shadow-lg py-1 z-20" [class.hidden]="!isActivityDropdownOpen()">
              <a routerLink="/activity/console" (click)="closeAllDropdowns()" class="block w-full text-left px-4 py-2 text-sm text-gray-300 hover:bg-gray-700 hover:text-orange-400 cursor-pointer flex items-center">
                <i class="fa-solid fa-greater-than w-6 text-center"></i>
                <span>{{ 'subnav.activity.console' | translate }}</span>
              </a>
              <a routerLink="/activity/system-log" (click)="closeAllDropdowns()" class="block w-full text-left px-4 py-2 text-sm text-gray-300 hover:bg-gray-700 hover:text-orange-400 cursor-pointer flex items-center">
                <i class="fa-solid fa-file-lines w-6 text-center"></i>
                <span>{{ 'subnav.activity.systemLog' | translate }}</span>
              </a>
              @if (trapsEnabled()) {
                <a routerLink="/activity/snmp-traps" (click)="closeAllDropdowns()" class="block w-full text-left px-4 py-2 text-sm text-gray-300 hover:bg-gray-700 hover:text-orange-400 cursor-pointer flex items-center">
                  <i class="fa-solid fa-clipboard-list w-6 text-center"></i>
                  <span>{{ 'subnav.activity.snmpLog' | translate }}</span>
                </a>
              }
            </div>
          </div>

          <!-- Hardware Status Indicators -->
          <div class="hidden md:flex items-center space-x-4 bg-gray-800/50 px-3 py-1.5 rounded-lg shadow-inner border border-gray-700/50 mr-4">
            <!-- Network Indicators Group -->
            <div class="flex items-center space-x-2">
              <!-- Ethernet Port Indicator -->
              <div class="relative group flex items-center justify-center w-8 h-6" [title]="'header.ethernetActivity' | translate">
                <svg viewBox="0 0 24 24" fill="none" class="w-6 h-6">
                  <!-- RJ45 Port Body -->
                  <rect x="5" y="8" width="14" height="8" rx="1" ry="1" fill="#374151" stroke="#4B5563" stroke-width="1.5"/>
                  <!-- RJ45 Connector Clip Area -->
                  <path d="M7 8 L7 6 C7 5.44772 7.44772 5 8 5 L16 5 C16.5523 5 17 5.44772 17 6 L17 8 Z" fill="#374151" stroke="#4B5563" stroke-width="1.5"/>
                  <!-- Pins -->
                  @for (_ of [0,1,2,3,4,5,6,7]; track $index) {
                    <line [attr.x1]="6 + $index * 1.5" y1="14" [attr.x2]="6 + $index * 1.5" y2="15.5" stroke="#fbbf24" stroke-width="0.5"/>
                  }

                  <!-- Link Status LED (Green/Gray) -->
                  <circle cx="7" cy="10" r="1.5"
                          [attr.fill]="connectionStatus() === 'connected' ? '#4ADE80' : '#4B5563'"
                          [class.animate-pulse]="connectionStatus() === 'connected'"
                          style="transition: fill 0.3s ease-in-out;"/>

                  <!-- Traffic LED (Yellow/Gray, Blinking) -->
                  <circle cx="17" cy="10" r="1.5"
                          [attr.fill]="ethernetActivity() ? '#FACC15' : '#4B5563'"
                          [class.animate-pulse]="ethernetActivity()"
                          style="transition: fill 0.1s ease-in-out;"/>
                </svg>
              </div>

              <!-- Wireless Status Indicator -->
              @if (wifiConfig().MODE !== 'Disabled') {
                <div class="relative group flex items-center justify-center w-6 h-6"
                  [title]="wifiConfig().MODE === 'AP' ? ('header.wifiApActive' | translate) : ('header.wifiStationStatus' | translate: { status: wifiStatus().status, signalStrength: wifiStatus().signalStrength })">
                  <svg class="w-5 h-5" [class]="arduinoService.getWifiSignalColorClass()" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    @if (wifiConfig().MODE === 'AP') {
                      <!-- AP mode icon - often represented as a larger wifi symbol or specific "hotspot" icon if available -->
                      <!-- Re-using existing WiFi paths, but with AP-specific title and color handling in getWifiSignalColorClass -->
                      <path d="M1.42 9a16 16 0 0 1 21.16 0" class="opacity-100"></path>
                      <path d="M5 12.55a11 11 0 0 1 14.08 0" class="opacity-100"></path>
                      <path d="M8.53 16.11a6 6 0 0 1 6.95 0" class="opacity-100"></path>
                      <line x1="12" y1="20" x2="12.01" y2="20" class="opacity-100"></line>
                      <title>Wireless AP Active</title>
                    } @else {
                      <!-- Bar 3 (furthest) -->
                      <path d="M1.42 9a16 16 0 0 1 21.16 0" [class.opacity-100]="wifiSignalBars() >= 4" class="opacity-25 transition-opacity duration-300"></path>
                      <!-- Bar 2 -->
                      <path d="M5 12.55a11 11 0 0 1 14.08 0" [class.opacity-100]="wifiSignalBars() >= 3" class="opacity-25 transition-opacity duration-300"></path>
                      <!-- Bar 1 (closest) -->
                      <path d="M8.53 16.11a6 6 0 0 1 6.95 0" [class.opacity-100]="wifiSignalBars() >= 2" class="opacity-25 transition-opacity duration-300"></path>
                      <!-- Dot -->
                      <line x1="12" y1="20" x2="12.01" y2="20" [class.opacity-100]="wifiSignalBars() >= 1" class="opacity-25 transition-opacity duration-300"></line>
                      <title>Wireless Station {{ wifiStatus().status }}</title>
                    }
                  </svg>
                </div>
              }
            </div>

            <!-- Separator -->
            <div class="w-px h-6 bg-gray-700"></div>

            <!-- Onboard LED Indicator -->
            <button type="button" class="relative group flex items-center focus:outline-none rounded-full" [title]="'header.onboardLedTitle' | translate" (click)="flashOnboardLed()">
                <div class="w-6 h-6 rounded-full flex items-center justify-center"
                    [style.backgroundColor]="onboardLed().color !== 'off' ? hexToRgba(onboardLed().color, 0.15) : '#374151'">
                    <div class="w-3 h-3 rounded-full transition-colors duration-300"
                        [class.animate-pulse]="onboardLed().flashing"
                        [style.backgroundColor]="onboardLed().color !== 'off' ? onboardLed().color : '#6b7280'"
                        [style.boxShadow]="onboardLed().color !== 'off' ? '0 0 6px ' + hexToRgba(onboardLed().color, 0.7) : 'none'"
                        [style.filter]="'brightness(' + onboardLed().brightness / 255 + ')'">
                    </div>
                </div>
            </button>
          </div>
        </div>
      </div>
    </div>
  </header>

  <!-- Container for all top banners -->
  <div class="fixed top-[56px] left-0 right-0 z-30 flex flex-col items-center">
    <!-- Firmware Update Notification -->
    @if (firmwareUpdate(); as update) {
      <div class="w-full bg-blue-900/90 border-b border-blue-700 py-3 shadow-lg cursor-pointer"
           [class.animate-firmware-fade-out]="applyFirmwareFadeOut()"
           (click)="dismissFirmwareUpdate(update.version)">
        <div class="px-4 sm:px-6 lg:px-8">
          <div class="flex items-center space-x-3">
            <i class="fa-solid fa-rocket text-blue-400 animate-pulse text-lg"></i>
            <span class="text-sm text-blue-100">
              {{ 'banner.firmwareUpdate' | translate }}
              <strong class="font-bold text-white">v{{ update.version }}</strong>
              ({{ 'banner.releasedOn' | translate: { releaseDate: (update.releaseDate | date:'dd/MM/yy') } }})
            </span>
            <a href="https://github.com/kiwiscanwifi/fireCNCv2-application/33568d768303c95a5d0a362173bd58806fe8d602/Images/ESP32-S3-POE-ETH-8DI-8DO-details-1.jpg" target="_blank" rel="noopener noreferrer" class="font-semibold text-blue-200 hover:text-blue-50 hover:underline whitespace-nowrap text-xs sm:text-sm"
               (click)="$event.stopPropagation()">
              {{ 'banner.viewOnGithub' | translate }}
            </a>
          </div>
        </div>
      </div>
    }

    <!-- Global Notifications -->
    @for (notification of notificationService.notifications(); track notification.id) {
      <div (click)="notificationService.clear(notification)" 
           class="w-full py-3 shadow-lg animate-fade-in cursor-pointer border-b"
           [class]="getNotificationClass(notification.type)"
           [class.animate-notification-fade-out]="notification.fadingOut">
          <div class="px-4 sm:px-6 lg:px-8">
              <div class="flex items-center space-x-3">
                  <i class="text-lg" [class]="getNotificationIcon(notification.type)"></i>
                  <span class="text-sm">
                      <strong class="font-bold text-white">{{ getNotificationTitle(notification.type) }}</strong>
                      {{ notification.message }}
                  </span>
              </div>
          </div>
      </div>
    }
  </div>


  <!-- Mobile nav - MOVED HERE -->
  @if (showMobileMenu()) {
    <nav class="md:hidden mt-2 px-2 sm:px-4">
      <div class="flex flex-wrap items-center gap-2 bg-gray-800/50 p-2 rounded-lg justify-center">
        <a routerLink="/status"
           routerLinkActive="text-orange-400 bg-gray-700"
           class="text-center text-gray-300 hover:text-orange-400 transition-colors duration-200 px-3 py-1.5 text-xs font-medium rounded-md whitespace-nowrap">
           {{ 'mobileNav.status' | translate }}
        </a>
        <a routerLink="/settings/landing"
           routerLinkActive="text-orange-400 bg-gray-700"
           class="text-center text-gray-300 hover:text-orange-400 transition-colors duration-200 px-3 py-1.5 text-xs font-medium rounded-md whitespace-nowrap">
           {{ 'mobileNav.settings' | translate }}
        </a>
        <a routerLink="/information/landing"
           routerLinkActive="text-orange-400 bg-gray-700"
           class="text-center text-gray-300 hover:text-orange-400 transition-colors duration-200 px-3 py-1.5 text-xs font-medium rounded-md whitespace-nowrap">
           {{ 'mobileNav.info' | translate }}
        </a>
        <a routerLink="/activity/landing"
           routerLinkActive="text-orange-400 bg-gray-700"
           class="text-center text-gray-300 hover:text-orange-400 transition-colors duration-200 px-3 py-1.5 text-xs font-medium rounded-md whitespace-nowrap">
           {{ 'mobileNav.activity' | translate }}
        </a>
        <a routerLink="/leds"
           routerLinkActive="text-orange-400 bg-gray-700"
           class="text-center text-gray-300 hover:text-orange-400 transition-colors duration-200 px-3 py-1.5 text-xs font-medium rounded-md whitespace-nowrap">
           {{ 'mobileNav.visuals' | translate }}
        </a>
        @if (showPendantLink()) {
          <a [routerLink]="pendantLink()"
            routerLinkActive="text-orange-400 bg-gray-700"
            class="text-center text-gray-300 hover:text-orange-400 transition-colors duration-200 px-3 py-1.5 text-xs font-medium rounded-md whitespace-nowrap">
            {{ 'mobileNav.pendant' | translate }}
          </a>
        }
        @if (isAlexaEnabled()) {
          <a routerLink="/alexa"
            routerLinkActive="text-orange-400 bg-gray-700"
            class="text-center text-gray-300 hover:text-orange-400 transition-colors duration-200 px-3 py-1.5 text-xs font-medium rounded-md whitespace-nowrap">
            {{ 'mobileNav.alexa' | translate }}
          </a>
        }
      </div>
    </nav>
  }

  <div class="flex-grow overflow-y-auto flex flex-col px-0 sm:px-6 lg:px-8 pt-2 sm:pt-3 lg:pt-4 pb-2 sm:pb-3 lg:pb-4">

    <router-outlet></router-outlet>

    <!-- Reboot Confirmation Modal -->
    @if (showRebootConfirmation()) {
      <app-confirmation-modal
        [title]="'modal.reboot.title' | translate"
        [message]="'modal.reboot.message' | translate"
        [confirmText]="'modal.reboot.confirm' | translate"
        [cancelText]="'modal.general.cancel' | translate"
        (confirm)="handleRebootConfirm()"
        (cancel)="handleRebootCancel()">
      </app-confirmation-modal>
    }

    <footer class="mt-auto pt-2 text-xs text-gray-500">
      <div class="border-t border-gray-700 pt-2 flex justify-between items-center">
        <div class="flex items-center">
          <!-- Admin Mode Indicator -->
          @if (isAdminMode()) {
            <span class="text-green-400 font-semibold px-2 py-1 rounded-md bg-green-900/20 flex items-center mr-3" [title]="'footer.adminModeEnabled.title' | translate">
              <i class="fa-solid fa-shield-alt md:mr-2"></i>
              <span class="hidden md:inline">{{ 'footer.adminModeEnabled.text' | translate }}</span>
            </span>
          }
          <!-- Login/Logout Icon Button -->
          @if (isAdminMode()) {
            <button (click)="handleLogout()" class="text-gray-400 hover:text-orange-400 transition-colors cursor-pointer mr-2" [title]="'footer.logout.title' | translate">
              <i class="fa-solid fa-arrow-right-from-bracket text-base"></i>
            </button>
          } @else {
            <button (click)="openAccessCodeModal()" class="text-gray-400 hover:text-orange-400 transition-colors cursor-pointer mr-2" [title]="'footer.login.title' | translate">
              <i class="fa-solid fa-arrow-right-to-bracket text-base"></i>
            </button>
          }
          <!-- fireCNC Application Version -->
          <span>
            {{ 'footer.appVersion' | translate: { appVersion: appVersion } }} 
            <span class="hidden md:inline">{{ 'footer.released' | translate: { appReleaseDate: (appReleaseDate | date:'dd/MM/yy') } }}</span>
          </span>
          @if (githubAppVersionInfo(); as info) {
            <span class="hidden md:inline ml-2 text-gray-400">{{ 'footer.latestGithub' | translate: { version: info.version } }}</span>
          }
        </div>
        <!-- Connection Statuses -->
        <div class="flex items-center space-x-4">
          <!-- Remote Config Status -->
          <a routerLink="/settings/general" [queryParams]="{ panel: 'remoteConfig' }" class="flex items-center space-x-1 bg-gray-800/50 px-3 py-1.5 rounded-lg shadow-inner border border-gray-700/50 hover:bg-gray-700/50 transition-colors cursor-pointer" [title]="remoteConfigStatusTitle()">
            <span class="text-sm font-medium text-gray-400 hidden lg:block">{{ 'footer.config' | translate }}</span>
            <div class="relative flex items-center justify-center w-4 h-4">
              <div class="relative w-full h-full flex items-center justify-center">
                <i class="fa-solid" [class]="remoteConfigStatusIcon()"></i>
              </div>
            </div>
          </a>
          <!-- Internet Status -->
          @if (internetConnectivityService.pingEnabled()) {
            <a routerLink="/status/details/internet" class="flex items-center space-x-1 bg-gray-800/50 px-3 py-1.5 rounded-lg shadow-inner border border-gray-700/50 hover:bg-gray-700/50 transition-colors cursor-pointer">
              <span class="text-sm font-medium text-gray-400 hidden lg:block">{{ 'footer.internet' | translate }}</span>
              <div class="relative flex items-center justify-center w-4 h-4">
                <div class="relative w-3 h-3 rounded-full" [class]="internetStatusColorClass()"></div>
              </div>
            </a>
          }
          <!-- ESP32 Status -->
          <a routerLink="/status/details/esp32" class="flex items-center space-x-1 bg-gray-800/50 px-3 py-1.5 rounded-lg shadow-inner border border-gray-700/50 hover:bg-gray-700/50 transition-colors cursor-pointer">
            <span class="text-sm font-medium text-gray-400 hidden lg:block">{{ 'footer.esp32' | translate }}</span>
            <div class="relative flex items-center justify-center w-4 h-4">
              @if(connectionStatus() === 'connecting' || connectionStatus() === 'restarting') {
                <div class="absolute w-full h-full rounded-full animate-ping" [class]="arduinoService.getConnectionStatusColorClass(connectionStatus())"></div>
              }
              <div class="relative w-3 h-3 rounded-full" [class]="arduinoService.getConnectionStatusColorClass(connectionStatus())"></div>
            </div>
          </a>
          <!-- LinuxCNC Status -->
          <a routerLink="/status/details/linuxcnc" class="flex items-center space-x-1 bg-gray-800/50 px-3 py-1.5 rounded-lg shadow-inner border border-gray-700/50 hover:bg-gray-700/50 transition-colors cursor-pointer">
            <span class="text-sm font-medium text-gray-400 hidden lg:block">{{ 'footer.linuxcnc' | translate }}</span>
            <div class="relative flex items-center justify-center w-4 h-4">
              @if(linuxCncConnectionStatus() === 'connecting' || linuxCncConnectionStatus() === 'restarting') {
                <div class="absolute w-full h-full rounded-full animate-ping" [class]="arduinoService.getConnectionStatusColorClass(linuxCncConnectionStatus())"></div>
              }
              <div class="relative w-3 h-3 rounded-full" [class]="arduinoService.getConnectionStatusColorClass(linuxCncConnectionStatus())"></div>
            </div>
          </a>
        </div>
      </div>
    </footer>
  </div>

</div>

<!-- Reboot Overlay -->
@if (showRebootOverlay()) {
  <div class="fixed inset-0 bg-gray-900/90 flex flex-col items-center justify-center z-50 text-white animate-fade-in">
    <div class="relative flex items-center justify-center">
      <div class="absolute w-24 h-24 rounded-full border-4 border-orange-500 border-t-transparent animate-spin"></div>
      <i class="fa-solid fa-power-off text-5xl text-orange-400"></i>
    </div>
    <p class="mt-8 text-xl font-semibold text-gray-200">{{ 'rebootOverlay.rebooting' | translate }}</p>
    <p class="mt-2 text-sm text-gray-400">{{ 'rebootOverlay.pleaseWait' | translate }}</p>
  </div>
}

<!-- Access Code Modal -->
@if (showAccessCodeModal()) {
  <app-access-code-modal (login)="handleLogin($event)" (close)="showAccessCodeModal.set(false)" [loginError]="loginError()"></app-access-code-modal>
}