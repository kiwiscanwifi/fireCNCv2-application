<main class="flex-grow">
  <form [formGroup]="onboardSettingsForm" (ngSubmit)="saveSettings()">
    <!-- Header for Save/Reset Actions -->
    <div class="sticky top-0 bg-gray-900/80 backdrop-blur-sm z-10 mb-4">
      <div class="flex justify-between items-center gap-4">
        <h2 class="text-xl font-bold text-gray-200 flex items-center">
          <i class="fa-solid fa-microchip mr-3 text-orange-400"></i>
          Onboard I/O
        </h2>
        <div class="flex items-center gap-4">
          <button type="button" (click)="resetSettings()" [disabled]="!onboardSettingsForm.dirty"
            class="bg-gray-600 hover:bg-gray-700 disabled:bg-gray-700 disabled:opacity-50 disabled:cursor-not-allowed text-white font-bold py-2 px-6 rounded-lg transition-colors duration-200">
            Reset
          </button>
          <button type="submit" [disabled]="!onboardSettingsForm.dirty || onboardSettingsForm.invalid"
            class="bg-orange-500 hover:bg-orange-600 disabled:bg-orange-500/50 disabled:cursor-not-allowed text-white font-bold py-2 px-6 rounded-lg transition-colors duration-200 shadow-md">
            Save
          </button>
        </div>
      </div>
       <p class="text-gray-400 text-sm mt-2">Configure the names and visibility of the onboard digital inputs and outputs.</p>
    </div>

    <div class="bg-gray-800/50 border border-gray-700 rounded-lg p-6 shadow-lg">
      <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 lg:gap-8">
        <!-- Digital Outputs Configuration -->
        <div class="p-4 rounded-lg bg-gray-800/50 border-2 border-solid border-gray-700">
          <h3 class="font-bold text-gray-300 text-lg mb-4 flex items-center">
              <i class="fa-solid fa-toggle-on w-5 text-center mr-2 text-orange-400"></i>
              <!-- NEW: Editable Title for Digital Outputs Widget -->
              <input type="text" formControlName="digitalOutputsWidgetTitle" placeholder="Digital Outputs Title"
                     class="bg-gray-700 border border-gray-600 text-gray-200 text-lg rounded-lg focus:ring-orange-500 focus:border-orange-500 block p-1 font-semibold w-full">
          </h3>
          <div formArrayName="digitalOutputs" class="grid grid-cols-1 md:grid-cols-2 gap-4">
            @for(outputControl of digitalOutputs.controls; track $index) {
              <div [formGroupName]="$index" class="p-3 bg-gray-900/50 rounded-lg border border-gray-700 flex items-center justify-between gap-4">
                <span class="font-mono text-sm text-gray-500 shrink-0">DO{{ outputControl.get('ID')?.value }}</span>
                <input type="text" formControlName="NAME" placeholder="Output Name"
                       class="bg-gray-700 border border-gray-600 text-gray-200 text-sm rounded-lg focus:ring-orange-500 focus:border-orange-500 block p-2 font-semibold w-full">
                <button (click)="toggleOutputEnabled($index)" type="button" role="switch" [attr.aria-checked]="outputControl.get('ENABLED')?.value"
                        class="relative inline-flex h-6 w-11 flex-shrink-0 cursor-pointer rounded-full border-2 border-transparent transition-colors duration-200 ease-in-out focus:outline-none focus:ring-2 focus:ring-orange-500 focus:ring-offset-2 focus:ring-offset-gray-900"
                        [class]="outputControl.get('ENABLED')?.value ? 'bg-orange-500' : 'bg-gray-600'">
                  <span class="pointer-events-none inline-block h-5 w-5 transform rounded-full bg-white shadow ring-0 transition duration-200 ease-in-out"
                        [class]="outputControl.get('ENABLED')?.value ? 'translate-x-5' : 'translate-x-0'"></span>
                </button>
              </div>
            }
          </div>
        </div>

        <!-- Digital Inputs Configuration -->
        <div class="p-4 rounded-lg bg-gray-800/50 border-2 border-solid border-gray-700">
          <h3 class="font-bold text-gray-300 text-lg mb-4 flex items-center">
              <i class="fa-solid fa-eye w-5 text-center mr-2 text-orange-400"></i>
              <!-- NEW: Editable Title for Digital Inputs Widget -->
              <input type="text" formControlName="digitalInputsWidgetTitle" placeholder="Digital Inputs Title"
                     class="bg-gray-700 border border-gray-600 text-gray-200 text-lg rounded-lg focus:ring-orange-500 focus:border-orange-500 block p-1 font-semibold w-full">
          </h3>
          <div formArrayName="digitalInputs" class="grid grid-cols-1 md:grid-cols-2 gap-4">
            @for(inputControl of digitalInputs.controls; track $index) {
              <div [formGroupName]="$index" class="p-3 bg-gray-900/50 rounded-lg border border-gray-700 flex items-center justify-between gap-3">
                <span class="font-mono text-sm text-gray-500 shrink-0">DI{{ inputControl.get('ID')?.value }} (GPIO{{ inputControl.get('ID')?.value + 4 }})</span>
                <input type="text" formControlName="NAME" placeholder="Input Name"
                       class="bg-gray-700 border border-gray-600 text-gray-200 text-sm rounded-lg focus:ring-orange-500 focus:border-orange-500 block p-2 font-semibold w-full">
                <button (click)="toggleInputEnabled($index)" type="button" role="switch" [attr.aria-checked]="inputControl.get('ENABLED')?.value"
                        class="relative inline-flex h-6 w-11 flex-shrink-0 cursor-pointer rounded-full border-2 border-transparent transition-colors duration-200 ease-in-out focus:outline-none focus:ring-2 focus:ring-orange-500 focus:ring-offset-2 focus:ring-offset-gray-900"
                        [class]="inputControl.get('ENABLED')?.value ? 'bg-orange-500' : 'bg-gray-600'">
                  <span class="pointer-events-none inline-block h-5 w-5 transform rounded-full bg-white shadow ring-0 transition duration-200 ease-in-out"
                        [class]="inputControl.get('ENABLED')?.value ? 'translate-x-5' : 'translate-x-0'"></span>
                </button>
              </div>
            }
          </div>
        </div>
      </div>
    </div>
  </form>
</main>